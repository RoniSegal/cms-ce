<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd">

    <bean id="keyService" class="com.enonic.cms.core.internal.service.KeyServiceImpl">
        <property name="keyEngine" ref="keyEngine"/>
    </bean>

    <bean id="upgradePropertyResolver"
          class="com.enonic.cms.upgrade.service.StandardPropertyResolver">
    </bean>

    <!-- Transaction based upgrade service. -->
    <bean id="upgradeService" class="com.enonic.cms.upgrade.service.UpgradeServiceImpl">
        <property name="connectionFactory" ref="connectionFactory"/>
        <property name="dialect" ref="dialectFactory"/>
        <property name="transactionTemplate" ref="transactionTemplate"/>
        <property name="propertyResolver" ref="upgradePropertyResolver"/>
    </bean>

    <bean id="dataSourceService" class="com.enonic.cms.core.internal.service.DataSourceServiceImpl">
        <property name="calendarService" ref="calendarService"/>
        <property name="contentService" ref="contentService"/>
        <property name="contentDao" ref="contentDao"/>
        <property name="userDao" ref="userDao"/>
        <property name="presentationEngine" ref="presentationEngine"/>
        <property name="preferenceService" ref="preferenceService"/>
        <property name="securityService" ref="securityService"/>
        <property name="countryService" ref="countryService"/>
        <property name="localeService" ref="localeService"/>
        <property name="timeZoneService" ref="timeZoneService"/>
        <property name="timeService" ref="timeService"/>
        <property name="userStoreParser" ref="userStoreParser"/>
        <property name="userStoreService" ref="userStoreService"/>
        <property name="sitePropertiesService" ref="sitePropertiesService"/>
    </bean>

    <bean id="userServicesService"
          class="com.enonic.cms.core.internal.service.UserServicesServiceImpl">
        <property name="userServicesEngine">
            <bean id="userServicesEngine" class="com.enonic.vertical.engine.UserServicesEngine"
                  parent="abstractBaseEngine">
                <property name="commonHandler" ref="commonHandler"/>
                <property name="contentHandler" ref="contentHandler"/>
                <property name="categoryHandler" ref="categoryHandler"/>
                <property name="contentObjectHandler" ref="contentObjectHandler"/>
                <property name="groupHandler" ref="groupHandler"/>
                <property name="languageHandler" ref="languageHandler"/>
                <property name="logHandler" ref="logHandler"/>
                <property name="menuHandler" ref="menuHandler"/>
                <property name="pageHandler" ref="pageHandler"/>
                <property name="pageTemplateHandler" ref="pageTemplateHandler"/>
                <property name="sectionHandler" ref="sectionHandler"/>
                <property name="securityHandler" ref="securityHandler"/>
                <property name="userHandler" ref="userHandler"/>
            </bean>
        </property>
    </bean>


    <bean id="tightestCacheSettingsResolver"
          class="com.enonic.cms.business.TightestCacheSettingsResolver"/>

    <!--
        Engines
    -->

    <bean id="keyEngine" class="com.enonic.vertical.engine.KeyEngine" parent="abstractBaseEngine">
        <property name="keyHandler" ref="key-keyHandler"/>
        <property name="commonHandler" ref="key-commonHandler"/>
    </bean>


    <!--
      Resolvers
    -->
    <bean id="resolverInputXMLCreator"
          class="com.enonic.cms.core.resolver.ResolverInputXMLCreator"/>

    <bean id="resolverXMLCreator"
          class="com.enonic.cms.core.resolver.ResolverHttpRequestInputXMLCreator"/>
    <bean id="resolverInputCreator"
          class="com.enonic.cms.core.resolver.ResolverHttpRequestInputCreator"/>


    <bean id="cookieOrSessionForcedResolverValueService"
          class="com.enonic.cms.core.resolver.ForceResolverValueServiceImpl"/>
    <bean id="sessionCachedResolverValueService"
          class="com.enonic.cms.core.resolver.CacheResolverValueServiceImpl"/>

    <!-- Device Class -->
    <bean id="deviceClassificationService"
          class="com.enonic.cms.core.resolver.deviceclass.DeviceClassResolverServiceImpl">
        <property name="deviceClassScriptResolver" ref="deviceClassXsltScriptResolver"/>
        <property name="forceResolverValueService" ref="cookieOrSessionForcedResolverValueService"/>
        <property name="cacheResolverValueService" ref="sessionCachedResolverValueService"/>
    </bean>

    <!-- Localization -->
    <bean id="localizeService" class="com.enonic.cms.core.localization.LocalizationServiceImpl"/>
    <bean id="localizationResourceBundleService"
          class="com.enonic.cms.core.localization.resource.LocalizationResourceBundleServiceImpl">
        <property name="propertiesCache">
            <bean class="com.enonic.cms.framework.cache.CacheFacadeFactory">
                <property name="cacheManager" ref="cacheFacadeManager"/>
                <property name="cacheName" value="localization"/>
            </bean>
        </property>
    </bean>

    <bean id="localeResolverService"
          class="com.enonic.cms.core.resolver.locale.LocaleResolverServiceImpl">
        <property name="localeScriptResolver" ref="localeXsltScriptResolver"/>
        <property name="forceResolverValueService" ref="cookieOrSessionForcedResolverValueService"/>
    </bean>

    <bean id="localeXsltScriptResolver"
          class="com.enonic.cms.core.resolver.locale.LocaleXsltScriptResolver"/>

    <!--
        Misc.
    -->

    <bean id="adminConsoleTranslationService"
          class="com.enonic.cms.business.AdminConsoleTranslationService" init-method="init">
        <property name="defaultLanguageCode" value="${cms.admin.defaultLanguage}"/>
    </bean>

    <bean id="adminConsoleLoginAccessResolver"
          class="com.enonic.vertical.adminweb.access.AdminConsoleLoginAccessResolver"/>

    <bean id="userServicesRedirectHelper"
          class="com.enonic.vertical.userservices.UserServicesRedirectUrlResolver"></bean>

    <bean id="reindexContentToolService"
          class="com.enonic.cms.business.tools.ReindexContentToolServiceImpl"/>

    <bean id="timeService" class="com.enonic.cms.framework.time.SystemTimeService"/>

    <bean class="org.springframework.mail.javamail.JavaMailSenderImpl">
        <property name="host" value="${cms.mail.smtpHost}"/>
    </bean>

    <bean id="sendMailService" class="com.enonic.cms.core.mail.SendMailServiceImpl">
        <property name="fromMail" value="${cms.admin.email}"/>
    </bean>

    <bean id="loginService" class="com.enonic.cms.business.login.LoginServiceImpl">
        <property name="autologinTimeoutInDays"
                  value="${com.enonic.vertical.presentation.autologinTimeout}"/>
    </bean>

</beans>

